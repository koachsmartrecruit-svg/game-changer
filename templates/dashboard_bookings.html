{% extends "base.html" %}
{% block content %}

<div class="container py-4 py-lg-5">

  <!-- ================= HEADER ================= -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 serif-font mb-0">Bookings & Schedule</h1>
      <p class="text-muted mb-0">Manage your sessions and client requests</p>
    </div>

    <div class="btn-group shadow-sm">
      <a href="{{ url_for('coach_dashboard') }}" class="btn btn-outline-dark">
        Overview
      </a>
      <a href="{{ url_for('coach_bookings') }}" class="btn btn-dark active">
        Bookings
      </a>
      <a href="{{ url_for('coach_profile') }}" class="btn btn-outline-dark">
        Profile
      </a>
    </div>
  </div>

  <!-- ================= FILTER BAR ================= -->
  <div class="d-flex justify-content-end mb-4">
    <div class="btn-group btn-group-sm shadow-sm">

      <a href="{{ url_for('coach_bookings', filter='all') }}"
         class="btn dashboard-filter-pill {% if booking_filter == 'all' %}active{% endif %}">
        All
      </a>

      <a href="{{ url_for('coach_bookings', filter='pending') }}"
         class="btn dashboard-filter-pill {% if booking_filter == 'pending' %}active{% endif %}">
        Pending
      </a>

      <a href="{{ url_for('coach_bookings', filter='confirmed') }}"
         class="btn dashboard-filter-pill {% if booking_filter == 'confirmed' %}active{% endif %}">
        Confirmed
      </a>

      <a href="{{ url_for('coach_bookings', filter='rejected') }}"
         class="btn dashboard-filter-pill {% if booking_filter == 'rejected' %}active{% endif %}">
        Rejected
      </a>

      <a href="{{ url_for('coach_bookings', filter='upcoming') }}"
         class="btn dashboard-filter-pill {% if booking_filter == 'upcoming' %}active{% endif %}">
        Upcoming
      </a>

    </div>
  </div>

  <!-- ================= BOOKINGS LIST ================= -->
  <div class="card gc-card border-0 rounded-4 overflow-hidden">

    <div class="card-header dashboard-card-header-dark border-0">
      <h5 class="fw-bold mb-0">Client Bookings</h5>
      <small class="text-muted">Students who hired you</small>
    </div>

    <div class="card-body p-0">

      {% if received_bookings %}
      <div class="list-group list-group-flush">

        {% for booking in received_bookings %}
        <div class="list-group-item border-0 p-4 dashboard-list-item">

          <div class="d-flex align-items-start gap-3">

            <!-- Avatar -->
            {% if booking.student.profile_image %}
              <img src="{{ url_for('static', filename='uploads/' + booking.student.profile_image) }}"
                   class="rounded-circle border"
                   width="48" height="48"
                   style="object-fit: cover;">
            {% else %}
              <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center"
                   style="width:48px;height:48px;">
                <strong>{{ booking.student.name[0].upper() }}</strong>
              </div>
            {% endif %}

            <!-- DETAILS -->
            <div class="flex-grow-1">

              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="fw-bold mb-0">{{ booking.student.name }}</h6>
                  <small class="text-muted">
                    {{ booking.sport }} Session •
                    {{ booking.booking_date.strftime('%d %b %Y') }} @ {{ booking.booking_time }}
                  </small>
                </div>

                <span class="badge dashboard-status-badge
                  {% if booking.status == 'Confirmed' %}
                    dashboard-status-confirmed
                  {% elif booking.status == 'Rejected' %}
                    dashboard-status-rejected
                  {% else %}
                    dashboard-status-pending
                  {% endif %}">
                  {{ booking.status }}
                </span>
              </div>

              <!-- LOCATION (UPDATED LOGIC) -->
              {% if booking.venue_type == 'student_home' %}
                <div class="mt-2 d-flex flex-column gap-1">
                  <span class="badge bg-warning text-dark d-inline-flex align-items-center gap-1">
                    <i class="bi bi-house-door-fill"></i>
                    Student’s Home
                  </span>
                  <div class="small text-muted">
                    {{ booking.student_address or "Address not provided" }}
                  </div>
                </div>
              {% else %}
                <div class="mt-2 d-flex flex-column gap-1">
                  <span class="badge bg-success d-inline-flex align-items-center gap-1">
                    <i class="bi bi-geo-alt-fill"></i>
                    Coach Venue
                  </span>
                  <div class="small text-muted">
                    {{ booking.location or "Location not specified" }}
                  </div>
                </div>
              {% endif %}

              <!-- NOTE -->
              {% if booking.message %}
              <div class="small fst-italic text-secondary mt-2">
                “{{ booking.message }}”
              </div>
              {% endif %}

              <!-- ACTION BUTTONS -->
              {% if booking.status == 'Pending' %}
              <div class="mt-3">

                <form method="POST"
                      action="{{ url_for('update_booking_status', booking_id=booking.id) }}"
                      class="d-inline">
                  <input type="hidden" name="status" value="Confirmed">
                  <button class="btn btn-success btn-sm rounded-pill px-3">
                    Accept
                  </button>
                </form>

                <form method="POST"
                      action="{{ url_for('update_booking_status', booking_id=booking.id) }}"
                      class="d-inline">
                  <input type="hidden" name="status" value="Rejected">
                  <button class="btn btn-outline-danger btn-sm rounded-pill px-3">
                    Reject
                  </button>
                </form>

              </div>
              {% endif %}

            </div>

          </div>
        </div>
        {% endfor %}

      </div>

      {% else %}
      <!-- EMPTY STATE -->
      <div class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted opacity-25"></i>
        <p class="text-muted mt-2 mb-1">No bookings found</p>
        <small class="text-muted">
          Once students book you, they’ll appear here ✨
        </small>
      </div>
      {% endif %}

    </div>
  </div>

</div>

{% endblock %}
